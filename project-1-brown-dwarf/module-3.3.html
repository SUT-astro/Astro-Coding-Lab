<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>การจำแนกดาวแคระน้ำตาลด้วย Machine learning</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="../assets/img/favicon.png" rel="icon">
  <link href="../assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,600;1,700&family=Roboto:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Work+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Sarabun:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="../assets/vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
  <link href="../assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="../assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="../assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  
  <!-- Template Main CSS File -->
  <link href="../assets/css/main.css" rel="stylesheet">
  <link href="../assets/css/project.css" rel="stylesheet">
  <link href="../assets/css/default.highlight.style.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: UpConstruction
  * Updated: Sep 18 2023 with Bootstrap v5.3.2
  * Template URL: https://bootstrapmade.com/upconstruction-bootstrap-construction-website-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->

</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="header d-flex align-items-center">
    <div class="container-fluid container-xl d-flex align-items-center justify-content-between">

      <a href="../index.html" class="logo logo-project d-flex align-items-center">
        <h1>AstroCode101<span>.</span></h1>
      </a>

      <i class="mobile-nav-toggle mobile-nav-show bi bi-list"></i>
      <i class="mobile-nav-toggle mobile-nav-hide d-none bi bi-x"></i>
      <nav id="navbar" class="navbar navbar-project">
        <ul>
          <li><a href="../index.html">Home</a></li>
          <li class="dropdown"><a href="../index.html#projects" class="active">Projects</a>
		    <ul>
              <li><a href="objective.html">Project Brown Dwarf</a></li>
			</ul>
		  </li>
        </ul>
      </nav><!-- .navbar -->

    </div>
  </header><!-- End Header -->

  <main id="main">

    <!-- ======= Breadcrumbs ======= -->
    <div class="breadcrumbs b-head d-flex">
	  <div class="container position-relative d-flex flex-column aos-init aos-animate" data-aos="fade">
        <h1>LAB-1: การจำแนกดาวแคระน้ำตาลด้วย Random Forest</h1>
      </div>
    </div><!-- End Breadcrumbs -->

    <!-- ======= Projet Details Section ======= -->
    <section id="project-details" class="project-details" 
	style="padding: 0 0 0 0;">
      <div class="project-content">
	  
	    <!--
	    <div class="table-of-content-title">
		  <nav class="sidebar-content project-sidebar">
	  	    <h1 style="color: #ffb800;">Content</h1>
		    <ol>
			  <li>
			    <a href="objective.html#Objective">
				  วัตถุประสงค์
				</a>
			  </li>

			  <li>
			    <a href="brown-dwarf.html#brown-dwarf">
				  ดาวแคระน้ำตาล (Brown Dwarfs)
				</a>
		        <ol>
			      <li>
				    <a href="brown-dwarf.html#what-is-brown-dwarf">
					  ดาวแคระน้ำตาลคืออะไร และทำไมถูกค้นพบได้ยาก
					</a>
				  </li>
			      <li>
				    <a href="brown-dwarf.html#classifying-brown-dwarf">
					  การจำแนกดาวแคระน้ำตาล
					</a>
				  </li>
			      <li>
				    <a href="brown-dwarf.html#Quiz-I">
				      Quiz I
				    </a>
				  </li>				  
		        </ol>
			  </li>
			    
			  <li>
				<a href="brown-dwarf-observation-data.html#brown-dwarf-observation-data">
				  ข้อมูลการสังเกตการณ์ดาวแคระน้ำตาล
				</a>
				<ol>
				  <li>
				    <a href="brown-dwarf-observation-data.html#Resource">
					  ที่มาและธรรมชาติของข้อมูล
					</a>
				  </li>
				  <li>
				    <a href="brown-dwarf-observation-data.html#using-pandas">
					  การใช้ pandas อ่านข้อมูล
					</a>
				  </li>
				  <li>
				    <a href="brown-dwarf-observation-data.html#data-processing-augmentation">
					  การเติมข้อมูล (Augmentation) ด้วย Gaussian-distributed noise
					</a>
				  </li>
				  <li>
				    <a href="brown-dwarf-observation-data.html#data-processing-missing-value">
					การจัดการกับข้อมูลที่หายไป (Missing value)
					</a>
				  </li>
				  <li>
				    <a href="brown-dwarf-observation-data.html#Quiz-II">
				      Quiz II
				    </a>
				  </li>
				</ol>
			  </li>
				
			  <li>
				<a href="machine-learning-for-brown-dwarf-classification.html#machine-learning-for-brown-dwarf-classification">
				  แบบจำลอง Random Forest (RF model)
				</a>
				<ol>
				  <li>
				    <a href="machine-learning-for-brown-dwarf-classification.html#decision-tree">
					  ต้นไม้การตัดสินใจ (Decision tree)
					</a>
				  </li>
				  <li>
				    <a href="machine-learning-for-brown-dwarf-classification.html#random-forest-regression">
				      RF regression
				    </a>
				  </li>
				  <li>
				    <a href="machine-learning-for-brown-dwarf-classification.html#brown-dwarf-classification-with-random-forest">
					  เขียนโค้ดจำแนกดาวแคระน้ำตาลด้วย RF model  
				    </a>
				  </li>
				</ol>	
			  </li>				  
			</ol>		
		  </nav>
	    </div>
		-->

	    <div class="project-content-inner">
		    
		  <h1 id="machine-learning-for-brown-dwarf-classification">
			แบบจำลอง Random Forest (RF model)
		  </h1>

		  <h2 id="brown-dwarf-classification-with-random-forest">
			เขียนโค้ดจำแนกดาวแคระน้ำตาลด้วย RF model
		  </h2>

		  <p>
			ขั้นตอนแรก จะเป็นการ Extract ข้อมูลต่างๆที่จะต้องใช้ในขั้นตอนนี้
      โดย X คือ ข้อมูลที่จะถูกใช้ในการฝึกฝน(feature) Random forest classification model
      y คือ คำตอบใช้บอกRandom forest classification model ว่าเป็นดาวชนิดไหน(label)
      จากนั้นทำการจัดการกับข้อมูลที่หายไป (Missing value) ใน X ด้วย IterativeImputer ที่ถูกฝึกฝนมาใน section ก่อนหน้านี้
		  </p>
      <p>
        โดยตัวอย่างโค้ดจะเป็นดังนี้  
      </p>
      <pre>
        <code class="language-python">
# Extract ข้อมูลที่จะถูกใช้ในการฝึกฝนหรือ feature (X) และ ชนิดของดาว (y) จากข้อมูลทั้งหมด
X = all_df.drop('label', axis = 1)
y = all_df['label']
display(X)
display(y)
print("---------------------------------------------------------------------------------------------------------------------------------------------------------")
print("---------------------------------------------------------------------------------------------------------------------------------------------------------")
# ทำการ Imputation ชุดข้อมูลของเราด้วย ด้วยคำสั่ง '.transform'
X= pd.DataFrame(imp.transform(X))
display(X)
        </code>    
      </pre>
      <p>
        ผลลัพธ์จะเป็นดังนี้
        </p>
      <figure style="text-align: center; margin: 0; padding: 0; margin-bottom: 30px;">
        <img src="project-brown-dwarf-img/out put-12.png" 
        style="max-width: 100%; height: auto;">
      </figure>
      </p>
      <figure style="text-align: center; margin: 0; padding: 0; margin-bottom: 30px;">
        <img src="project-brown-dwarf-img/out put-13.png" 
        style="max-width: 100%; height: auto;">
      </figure>
		  <p>
        และทำการตัดข้อมูลใน colunm ที่ไม่ใช่ color index ออกไปทั้งหมด ก่อนนำไปฝึกฝน(train) Machine learing ด้วยคำสั่ง ".drop"
        ในกรณีนี้เมื่อเปรียบเทียบตารางด้านบนก่อนและหลัง Imputation จะเห็นว่าข้อมูล color index นั้น อยู่ใน coloum ที่ '3' '4' และ '5' ดังนั้นเราจะตัด coloum ที่'0' '1' และ '2' ออก 
        และทำการแบ่งข้อมูลออกเป็น 2 ชุด สำหรับการฝึกฝึน (X_trian และ y_train) และประเมิณผล (X_test และ y_test) Random forest classification model 
		  </p>
      <p>
        โดยตัวอย่างโค้ดจะเป็นดังนี้  
      </p>
      <pre>
        <code class="language-python">
  ## ตัด column ที่ coloum ที่ '0' '1' และ '2' ออก 
  X = X.drop([X.columns[0], X.columns[1], X.columns[2]], axis=1)
  display(X)
  
  # แบ่งข้อมูลเป็น 2 ชุด ชุดหนึ่งสำหรับการฝึกฝึน machine learing(80 % จากทั้งหมด) และ อีกชุดหนึงสำหรับทดสอบและประเมิณผลของ machine learning (20% จากทั้งหมด)ด้วยคำสั่ง  'train_test_spli'
  X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=50)
        </code>    
      </pre>
      <p>
        ผลลัพธ์จะเป็นดังนี้
        </p>
      <figure style="text-align: center; margin: 0; padding: 0; margin-bottom: 30px;">
        <img src="project-brown-dwarf-img/out put-14.png" 
        style="max-width: 100%; height: auto;">
      </figure>
      <p>
      ต่อไปเป็นขั้นตอนการฝึกฝน Random forest classification model โดยเราจะทำการหา hyperparameter ที่ดีที่สุด (fine-ture hyperparameter)  
      ด้วยฟังก์ชัน GridSearchCV() ของ libray Sci-kit learn โดยเราจะทำการ tuing hyperparameter ที่สำคัญ 2 ตัวคือ max_depth และ n_estimators      
      </p>
      <p>
        โดย
      </p>
      <p>
        max_depth คือ maximam depth หรือก็ความลึกของต้นไม้แต่ละต้นจาก root node
      </p>
      <p>
        และ n_estimators คือ จำนวนของต้นไม้การตัดสินใจ(Decision tree)ใน Random forest classification model
      </p>
      <p>
        โดยที่จะให้ฟังก์ชัน GridSearchCV() หาค่าของ max_depth ที่ดีที่สุดในช่วง 2-25 โดยมีตัวแปรจำนวน 10 ตัว และ n_estimators ที่ดีที่สุด ของตัวแปรต่อไปนี้ 1, 5, 50, 150, 200
      </p>
      <p>
        โดยตัวอย่างโค้ดจะเป็นดังนี้  
      </p>
      <pre>
        <code class="language-python">
# กำหนดขอบเขตของ max_depth
md =  np.arange(2, 31, 4, 'int')
# กำหนดตัวแปร n_estimator
n_e =[1, 5, 50, 150, 200]

# ใส่Parameterต่างๆใน ลงในฟังก์ชัน GridSearchCV() และกำหนด machine learning model ที่จะใช้ในการจำแนกผล กรณีนี้คือ Random Forest Classifier
param_grid = dict(max_depth=md, n_estimators=n_e)
grid = GridSearchCV(RandomForestClassifier(), param_grid=param_grid, cv=5)

# ฝึกฝน Machine learning ด้วยข้อมุล X_train และ y_train
grid.fit(X_train, y_train)

para = grid.best_params_
print('hyperparameters ทีดีที่สุดคือ', para)

score = grid.best_score_
print('ค่าความแม่นยำของชุดฝึกฝน =', score)

# คำสั่งพล็อต Heat map ของ hyparameter ต่าง ๆ
from matplotlib.colors import Normalize
class MidpointNormalize(Normalize):
    def __init__(self, vmin=None, vmax=None, midpoint=None, clip=False):
        self.midpoint = midpoint
        Normalize.__init__(self, vmin, vmax, clip)

    def __call__(self, value, clip=None):
        x, y = [self.vmin, self.midpoint, self.vmax], [0, 0.5, 1]
        return np.ma.masked_array(np.interp(value, x, y))

scores = grid.cv_results_['mean_test_score'].reshape(len(md),
                                                     len(n_e))

plt.figure(figsize=(8, 6))
plt.subplots_adjust(left=.2, right=0.95, bottom=0.15, top=0.95)
plt.imshow(scores, interpolation='nearest', cmap=plt.cm.Reds,
           norm=MidpointNormalize(vmin=0.2, midpoint=0.92))
plt.ylabel('$max_depth$')
plt.xlabel('n_estimators')

plt.colorbar()
plt.xticks(np.arange(len(n_e)), n_e, rotation=45)
plt.yticks(np.arange(len(md)), md)
plt.show()
        </code>    
      </pre>
      <p>
        ผลลัพธ์จะเป็นดังนี้
        </p>
      <figure style="text-align: center; margin: 0; padding: 0; margin-bottom: 30px;">
        <img src="project-brown-dwarf-img/out put-15.png" 
        style="max-width: 100%; height: auto;">
      </figure>
      <p>
        เราจะเห็นว่า hyperparameter ที่ดีที่สุดคือ max_depth = 10 และ n_estimators = 200
        และมีความแม่นยำสำหรับชุดที่ใช้ฝึกฝน ~ 0.84(~84%)
      </p>
      <p>
        ขั้นต่อไปจะเป็นการแสดงถึง ค่าความแม่นยำ และ Confusion Matrix สำหรับชุดที่ใช้ทดสอบ(ประเมิณผล)
      </p>
      <p>
        โดยตัวอย่างโค้ดจะเป็นดังนี้  
      </p>
      <pre>
        <code class="language-python">
#ประเมิณผลขอ model ด้วยชุดทดสอบ
y_predictions = grid.predict(X_test)
#คำนวนค่าความแม่นยำด้วยคำสั่ง r2_score
r2score = r2_score(y_test, y_predictions)
print('ค่าความแม่นยำของชุดทดสอบ =', score)
#การแสดง Confusion Matrix แบบจำนวน
cm = confusion_matrix(y_test, y_predictions, labels=grid.classes_)
disp = ConfusionMatrixDisplay(confusion_matrix=cm, display_labels=grid.classes_)

print("-----------------------------------------------------------------------------------------------------------------------------------------")
print("-----------------------------------------------------------------------------------------------------------------------------------------")


#การแสดง Confusion Matrix แบบPercentage
cmn = cm.astype('float') / cm.sum(axis=1)[:, np.newaxis]
dispp = ConfusionMatrixDisplay(confusion_matrix=cmn, display_labels=grid.classes_)

disp.plot()
dispp.plot()
plt.show()
        </code>    
      </pre>
      <p>
        ผลลัพธ์จะเป็นดังนี้
        </p>
      <figure style="text-align: center; margin: 0; padding: 0; margin-bottom: 30px;">
        <img src="project-brown-dwarf-img/out put-16.png" 
        style="max-width: 100%; height: auto;">
      </figure>
      <p>
        เราจะเห็นว่า ค่าความแม่นยำของชุดทดสอบสูงกว่าค่าความแม่นยำของชุดฝึกฝนเล็กน้อย(~1%) โดยมีความแม่นยำอยู่ที่ ~0.86(~86%) และในส่วนของ Confusion Matrix นั้นแสดงให้เห็นว่า model ของเรานั้นค่า
      </p>
      <p>
        True Positive (TP) ทำนายว่า “จริง” และ มีค่าที่เป็น “จริง” อยู่ที่ 88%
      </p>
      <p>
        True Negative (TN) ทำนายว่า “ไม่จริง” และ มีค่า “ไม่จริง” อยู่ที่ 83%
      </p>
      <p>
        False Positive ( FP ) ทำนายว่า “จริง” แต่มีค่าเป็น “ไม่จริง” อยู่ที่ 17%
      </p>
      <p>
        False Negative ( FN ) ทำนายว่า “ไม่จริง” แต่มีค่าเป็น “จริง” อยู่ที่ 12%
      </p>
 
		  <section class="chapter-button">
		    
			<a href="module-3.2.html">
			  <button>
			    &lt; &lt; <br>
				...
			  </button>
			</a>
			
			<a href="objective.html">
			  <button>
			    สารบัญ
			  </button>
			</a>
		    
			<a>
			  <button>
			    &gt; &gt;
			  </button>
			</a>
			
		  </section>
			
		</div>
      </div>
    </section><!-- End Projet Details Section -->

  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer" class="footer">

    <div class="footer-content position-relative">
      <div class="container">
        <div class="row">

          <div class="col-lg-4 col-md-6">
            <div class="footer-info">
              <h3>กลุ่มวิจัยดาราศาสตร์</h3>
              <p>
			          สาขาวิชาฟิสิกส์  สำนักวิชาวิทยาศาสตร์ <br>
				มหาวิทยาลัยเทคโนโลยีสุรนารี <br>
			          111  ถนนมหาวิทยาลัย <br>
                                        ต. สุรนารี  อ. เมือง  จ.นครราชสีมา<br>
				30000<br>
                <strong>Phone:</strong> 044-223-000<br>
                <strong>Fax:</strong> 044-224-070<br>
              </p>
              <div class="social-links d-flex mt-3">
                <a href="#" class="d-flex align-items-center justify-content-center"><i class="bi bi-twitter"></i></a>
                <a href="#" class="d-flex align-items-center justify-content-center"><i class="bi bi-facebook"></i></a>
                <a href="#" class="d-flex align-items-center justify-content-center"><i class="bi bi-instagram"></i></a>
                <a href="#" class="d-flex align-items-center justify-content-center"><i class="bi bi-linkedin"></i></a>
              </div>
            </div>
          </div><!-- End footer info column-->

          <div class="col-lg-2 col-md-3 footer-links">
            <h4>Useful Links</h4>
            <ul>
              <li><a href="#">Home</a></li>
              <li><a href="#">About us</a></li>
              <li><a href="#">Services</a></li>
              <li><a href="#">Terms of service</a></li>
              <li><a href="#">Privacy policy</a></li>
            </ul>
          </div><!-- End footer links column-->

          <div class="col-lg-2 col-md-3 footer-links">
            <h4>Our Services</h4>
            <ul>
              <li><a href="#">Web Design</a></li>
              <li><a href="#">Web Development</a></li>
              <li><a href="#">Product Management</a></li>
              <li><a href="#">Marketing</a></li>
              <li><a href="#">Graphic Design</a></li>
            </ul>
          </div><!-- End footer links column-->



        </div>
      </div>
    </div>

    <div class="footer-legal text-center position-relative">
      <div class="container">
        <div class="copyright">
          &copy; Copyright <strong><span>UpConstruction</span></strong>. All Rights Reserved
        </div>
        <div class="credits">
          <!-- All the links in the footer should remain intact. -->
          <!-- You can delete the links only if you purchased the pro version. -->
          <!-- Licensing information: https://bootstrapmade.com/license/ -->
          <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/upconstruction-bootstrap-construction-website-template/ -->
          Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
        </div>
      </div>
    </div>

  </footer>
  <!-- End Footer -->

  <a href="#" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="../assets/vendor/aos/aos.js"></script>
  <script src="../assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="../assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="../assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="../assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="../assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="../assets/js/main.js"></script>
  <script src="../assets/js/change-content.js"></script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
  
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <script src="module-chapter.js"></script>

</body>

</html>